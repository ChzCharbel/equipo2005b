<div class="col-sm-12 col-md-12 col-lg-8 col-xl-8">
    <h3 class="text-center mt-5">Horario</h3>
    <div class="table-responsive">
      <table class="table custom-table p-3 table-striped">
        <thead>
          <tr class="text-center">
            <th class="row-width-hour hour"></th>
            <th class="row-width">Lunes</th>
            <th class="row-width">Martes</th>
            <th class="row-width">Mi√©rcoles</th>
            <th class="row-width">Jueves</th>
            <th class="row-width">Viernes</th>
          </tr>
        </thead>
        <tbody>
          <%
          const colores = ['bg-primary', 'bg-success', 'bg-warning', 'bg-danger', 'bg-info', 'bg-secondary', 'bg-dark'];
          const materiasColor = {};
          let colorIndex = 0;
  
          const horario = { Lunes: {}, Martes: {}, Miercoles: {}, Jueves: {}, Viernes: {} };
  
          grupos.forEach(grupo => {
            ['Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes'].forEach(dia => {
              const inicio = grupo[dia.toLowerCase() + 'Inicio'];
              const fin = grupo[dia.toLowerCase() + 'Fin'];
              if (inicio && fin) {
                if (!materiasColor[grupo.materia.nombre]) {
                  materiasColor[grupo.materia.nombre] = colores[colorIndex % colores.length];
                  colorIndex++;
                }
  
                const [hi, mi] = inicio.split(':').map(Number);
                const [hf, mf] = fin.split(':').map(Number);
  
                const inicioBloque = hi * 2 + (mi >= 30 ? 1 : 0); // cada hora = 2 bloques
                const finBloque = hf * 2 + (mf >= 30 ? 1 : 0);
  
                horario[dia][inicioBloque] = {
                  rowspan: finBloque - inicioBloque,
                  nombre: grupo.materia.nombre,
                  color: materiasColor[grupo.materia.nombre]
                };
  
                for (let b = inicioBloque + 1; b < finBloque; b++) {
                  horario[dia][b] = 'ocupar';
                }
              }
            });
          });
  
          // render de 7:00 a 15:30 = 17 bloques de media hora
          for (let bloque = 14; bloque <= 31; bloque++) {
            const hora = Math.floor(bloque / 2);
            const minutos = bloque % 2 === 0 ? '00' : '30';
          %>
            <tr>
              <th class="hour text-center align-middle"><%= hora %>:<%= minutos %></th>
              <% ['Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes'].forEach(dia => { %>
                <% if (horario[dia][bloque] === 'ocupar') return; %>
                <% if (horario[dia][bloque]) { %>
                  <td class="text-white text-center align-middle <%= horario[dia][bloque].color %>" rowspan="<%= horario[dia][bloque].rowspan %>">
                    <%= horario[dia][bloque].nombre %>
                  </td>
                <% } else { %>
                  <td></td>
                <% } %>
              <% }) %>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  
    <div class="d-flex justify-content-end mt-3">
      <button class="btn btn-secondary me-2">Agregar materia</button>
      <button class="btn btn-primary">Confirmar</button>
    </div>
  </div>
  